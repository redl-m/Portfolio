const fs = require('fs');
const path = require('path');

// The directory where your trip photos are stored
const assetsDir = path.resolve(__dirname, '../../../public/assets/about/trips');
// The path for the auto-generated TypeScript file
const outputPath = path.join(__dirname, 'photo-manifest.ts');

try {
  // Get all subdirectories in the assets folder (e.g., 'Paris', 'NewYork')
  const tripFolders = fs.readdirSync(assetsDir).filter(file =>
    fs.statSync(path.join(assetsDir, file)).isDirectory()
  );

  const photoManifest = {};

  // Loop through each trip's folder
  for (const folder of tripFolders) {
    const tripFolderPath = path.join(assetsDir, folder);

    // Read all files in the folder and filter for common image types
    const photoFiles = fs.readdirSync(tripFolderPath)
      .filter(file => /\.(jpg|jpeg|png|gif|webp)$/i.test(file));

    // Create the full asset path for each photo
    photoManifest[folder] = photoFiles.map(file => `assets/about/trips/${folder}/${file}`);
  }

  // Create the content for the .ts file
  const fileContent = `// This file is auto-generated by generate-photo-manifest.js. Do not edit manually.\n\n` +
    `export const photoManifest: { [key: string]: string[] } = ${JSON.stringify(photoManifest, null, 2)};\n`;

  // Write the content to photo-manifest.ts
  fs.writeFileSync(outputPath, fileContent, 'utf8');
  console.log('✅ Photo manifest generated successfully!');

} catch (error) {
  console.error('❌ Error generating photo manifest:', error);
}
